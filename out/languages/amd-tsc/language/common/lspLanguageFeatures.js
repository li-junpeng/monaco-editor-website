define(["require","exports","vscode-languageserver-types","../../fillers/monaco-editor-core"],(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionRangeAdapter=t.FoldingRangeAdapter=t.DocumentColorAdapter=t.DocumentRangeFormattingEditProvider=t.DocumentFormattingEditProvider=t.DocumentLinkAdapter=t.DocumentSymbolAdapter=t.RenameAdapter=t.ReferenceAdapter=t.DefinitionAdapter=t.DocumentHighlightAdapter=t.HoverAdapter=t.toTextEdit=t.toRange=t.fromRange=t.fromPosition=t.CompletionAdapter=t.DiagnosticsAdapter=void 0;var i=function(){function e(e,t,n){var i=this;this._languageId=e,this._worker=t,this._disposables=[],this._listener=Object.create(null);var o=function(e){var t,n=e.getLanguageId();n===i._languageId&&(i._listener[e.uri.toString()]=e.onDidChangeContent((function(){window.clearTimeout(t),t=window.setTimeout((function(){return i._doValidate(e.uri,n)}),500)})),i._doValidate(e.uri,n))},a=function(e){r.editor.setModelMarkers(e,i._languageId,[]);var t=e.uri.toString(),n=i._listener[t];n&&(n.dispose(),delete i._listener[t])};this._disposables.push(r.editor.onDidCreateModel(o)),this._disposables.push(r.editor.onWillDisposeModel(a)),this._disposables.push(r.editor.onDidChangeModelLanguage((function(e){a(e.model),o(e.model)}))),this._disposables.push(n((function(e){r.editor.getModels().forEach((function(e){e.getLanguageId()===i._languageId&&(a(e),o(e))}))}))),this._disposables.push({dispose:function(){for(var e in r.editor.getModels().forEach(a),i._listener)i._listener[e].dispose()}}),r.editor.getModels().forEach(o)}return e.prototype.dispose=function(){this._disposables.forEach((function(e){return e&&e.dispose()})),this._disposables.length=0},e.prototype._doValidate=function(e,t){this._worker(e).then((function(t){return t.doValidation(e.toString())})).then((function(n){var i=n.map((function(e){return n="number"==typeof(t=e).code?String(t.code):t.code,{severity:o(t.severity),startLineNumber:t.range.start.line+1,startColumn:t.range.start.character+1,endLineNumber:t.range.end.line+1,endColumn:t.range.end.character+1,message:t.message,code:n,source:t.source};var t,n})),a=r.editor.getModel(e);a&&a.getLanguageId()===t&&r.editor.setModelMarkers(a,t,i)})).then(void 0,(function(e){console.error(e)}))},e}();function o(e){switch(e){case n.DiagnosticSeverity.Error:return r.MarkerSeverity.Error;case n.DiagnosticSeverity.Warning:return r.MarkerSeverity.Warning;case n.DiagnosticSeverity.Information:return r.MarkerSeverity.Info;case n.DiagnosticSeverity.Hint:return r.MarkerSeverity.Hint;default:return r.MarkerSeverity.Info}}t.DiagnosticsAdapter=i;var a=function(){function e(e,t){this._worker=e,this._triggerCharacters=t}return Object.defineProperty(e.prototype,"triggerCharacters",{get:function(){return this._triggerCharacters},enumerable:!1,configurable:!0}),e.prototype.provideCompletionItems=function(e,t,i,o){var a=e.uri;return this._worker(a).then((function(e){return e.doComplete(a.toString(),u(t))})).then((function(i){if(i){var o=e.getWordUntilPosition(t),a=new r.Range(t.lineNumber,o.startColumn,t.lineNumber,o.endColumn),u=i.items.map((function(e){var t,i,o={label:e.label,insertText:e.insertText||e.label,sortText:e.sortText,filterText:e.filterText,documentation:e.documentation,detail:e.detail,command:(t=e.command,t&&"editor.action.triggerSuggest"===t.command?{id:t.command,title:t.title,arguments:t.arguments}:void 0),range:a,kind:d(e.kind)};return e.textEdit&&(void 0!==(i=e.textEdit).insert&&void 0!==i.replace?o.range={insert:c(e.textEdit.insert),replace:c(e.textEdit.replace)}:o.range=c(e.textEdit.range),o.insertText=e.textEdit.newText),e.additionalTextEdits&&(o.additionalTextEdits=e.additionalTextEdits.map(l)),e.insertTextFormat===n.InsertTextFormat.Snippet&&(o.insertTextRules=r.languages.CompletionItemInsertTextRule.InsertAsSnippet),o}));return{isIncomplete:i.isIncomplete,suggestions:u}}}))},e}();function u(e){if(e)return{character:e.column-1,line:e.lineNumber-1}}function s(e){if(e)return{start:{line:e.startLineNumber-1,character:e.startColumn-1},end:{line:e.endLineNumber-1,character:e.endColumn-1}}}function c(e){if(e)return new r.Range(e.start.line+1,e.start.character+1,e.end.line+1,e.end.character+1)}function d(e){var t=r.languages.CompletionItemKind;switch(e){case n.CompletionItemKind.Text:return t.Text;case n.CompletionItemKind.Method:return t.Method;case n.CompletionItemKind.Function:return t.Function;case n.CompletionItemKind.Constructor:return t.Constructor;case n.CompletionItemKind.Field:return t.Field;case n.CompletionItemKind.Variable:return t.Variable;case n.CompletionItemKind.Class:return t.Class;case n.CompletionItemKind.Interface:return t.Interface;case n.CompletionItemKind.Module:return t.Module;case n.CompletionItemKind.Property:return t.Property;case n.CompletionItemKind.Unit:return t.Unit;case n.CompletionItemKind.Value:return t.Value;case n.CompletionItemKind.Enum:return t.Enum;case n.CompletionItemKind.Keyword:return t.Keyword;case n.CompletionItemKind.Snippet:return t.Snippet;case n.CompletionItemKind.Color:return t.Color;case n.CompletionItemKind.File:return t.File;case n.CompletionItemKind.Reference:return t.Reference}return t.Property}function l(e){if(e)return{range:c(e.range),text:e.newText}}t.CompletionAdapter=a,t.fromPosition=u,t.fromRange=s,t.toRange=c,t.toTextEdit=l;var g=function(){function e(e){this._worker=e}return e.prototype.provideHover=function(e,t,n){var r=e.uri;return this._worker(r).then((function(e){return e.doHover(r.toString(),u(t))})).then((function(e){if(e)return{range:c(e.range),contents:f(e.contents)}}))},e}();function m(e){return"string"==typeof e?{value:e}:(t=e)&&"object"==typeof t&&"string"==typeof t.kind?"plaintext"===e.kind?{value:e.value.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}:{value:e.value}:{value:"```"+e.language+"\n"+e.value+"\n```\n"};var t}function f(e){if(e)return Array.isArray(e)?e.map(m):[m(e)]}t.HoverAdapter=g;var p=function(){function e(e){this._worker=e}return e.prototype.provideDocumentHighlights=function(e,t,n){var r=e.uri;return this._worker(r).then((function(e){return e.findDocumentHighlights(r.toString(),u(t))})).then((function(e){if(e)return e.map((function(e){return{range:c(e.range),kind:h(e.kind)}}))}))},e}();function h(e){switch(e){case n.DocumentHighlightKind.Read:return r.languages.DocumentHighlightKind.Read;case n.DocumentHighlightKind.Write:return r.languages.DocumentHighlightKind.Write;case n.DocumentHighlightKind.Text:return r.languages.DocumentHighlightKind.Text}return r.languages.DocumentHighlightKind.Text}t.DocumentHighlightAdapter=p;var v=function(){function e(e){this._worker=e}return e.prototype.provideDefinition=function(e,t,n){var r=e.uri;return this._worker(r).then((function(e){return e.findDefinition(r.toString(),u(t))})).then((function(e){if(e)return[y(e)]}))},e}();function y(e){return{uri:r.Uri.parse(e.uri),range:c(e.range)}}t.DefinitionAdapter=v;var S=function(){function e(e){this._worker=e}return e.prototype.provideReferences=function(e,t,n,r){var i=e.uri;return this._worker(i).then((function(e){return e.findReferences(i.toString(),u(t))})).then((function(e){if(e)return e.map(y)}))},e}();t.ReferenceAdapter=S;var b=function(){function e(e){this._worker=e}return e.prototype.provideRenameEdits=function(e,t,n,i){var o=e.uri;return this._worker(o).then((function(e){return e.doRename(o.toString(),u(t),n)})).then((function(e){return function(e){if(e&&e.changes){var t=[];for(var n in e.changes)for(var i=r.Uri.parse(n),o=0,a=e.changes[n];o<a.length;o++){var u=a[o];t.push({resource:i,versionId:void 0,textEdit:{range:c(u.range),text:u.newText}})}return{edits:t}}}(e)}))},e}();t.RenameAdapter=b;var C=function(){function e(e){this._worker=e}return e.prototype.provideDocumentSymbols=function(e,t){var n=e.uri;return this._worker(n).then((function(e){return e.findDocumentSymbols(n.toString())})).then((function(e){if(e)return e.map((function(e){return{name:e.name,detail:"",containerName:e.containerName,kind:_(e.kind),range:c(e.location.range),selectionRange:c(e.location.range),tags:[]}}))}))},e}();function _(e){var t=r.languages.SymbolKind;switch(e){case n.SymbolKind.File:return t.Array;case n.SymbolKind.Module:return t.Module;case n.SymbolKind.Namespace:return t.Namespace;case n.SymbolKind.Package:return t.Package;case n.SymbolKind.Class:return t.Class;case n.SymbolKind.Method:return t.Method;case n.SymbolKind.Property:return t.Property;case n.SymbolKind.Field:return t.Field;case n.SymbolKind.Constructor:return t.Constructor;case n.SymbolKind.Enum:return t.Enum;case n.SymbolKind.Interface:return t.Interface;case n.SymbolKind.Function:return t.Function;case n.SymbolKind.Variable:return t.Variable;case n.SymbolKind.Constant:return t.Constant;case n.SymbolKind.String:return t.String;case n.SymbolKind.Number:return t.Number;case n.SymbolKind.Boolean:return t.Boolean;case n.SymbolKind.Array:return t.Array}return t.Function}t.DocumentSymbolAdapter=C;var k=function(){function e(e){this._worker=e}return e.prototype.provideLinks=function(e,t){var n=e.uri;return this._worker(n).then((function(e){return e.findDocumentLinks(n.toString())})).then((function(e){if(e)return{links:e.map((function(e){return{range:c(e.range),url:e.target}}))}}))},e}();t.DocumentLinkAdapter=k;var K=function(){function e(e){this._worker=e}return e.prototype.provideDocumentFormattingEdits=function(e,t,n){var r=e.uri;return this._worker(r).then((function(e){return e.format(r.toString(),null,I(t)).then((function(e){if(e&&0!==e.length)return e.map(l)}))}))},e}();t.DocumentFormattingEditProvider=K;var w=function(){function e(e){this._worker=e,this.canFormatMultipleRanges=!1}return e.prototype.provideDocumentRangeFormattingEdits=function(e,t,n,r){var i=e.uri;return this._worker(i).then((function(e){return e.format(i.toString(),s(t),I(n)).then((function(e){if(e&&0!==e.length)return e.map(l)}))}))},e}();function I(e){return{tabSize:e.tabSize,insertSpaces:e.insertSpaces}}t.DocumentRangeFormattingEditProvider=w;var D=function(){function e(e){this._worker=e}return e.prototype.provideDocumentColors=function(e,t){var n=e.uri;return this._worker(n).then((function(e){return e.findDocumentColors(n.toString())})).then((function(e){if(e)return e.map((function(e){return{color:e.color,range:c(e.range)}}))}))},e.prototype.provideColorPresentations=function(e,t,n){var r=e.uri;return this._worker(r).then((function(e){return e.getColorPresentations(r.toString(),t.color,s(t.range))})).then((function(e){if(e)return e.map((function(e){var t={label:e.label};return e.textEdit&&(t.textEdit=l(e.textEdit)),e.additionalTextEdits&&(t.additionalTextEdits=e.additionalTextEdits.map(l)),t}))}))},e}();t.DocumentColorAdapter=D;var x=function(){function e(e){this._worker=e}return e.prototype.provideFoldingRanges=function(e,t,i){var o=e.uri;return this._worker(o).then((function(e){return e.getFoldingRanges(o.toString(),t)})).then((function(e){if(e)return e.map((function(e){var t={start:e.startLine+1,end:e.endLine+1};return void 0!==e.kind&&(t.kind=function(e){switch(e){case n.FoldingRangeKind.Comment:return r.languages.FoldingRangeKind.Comment;case n.FoldingRangeKind.Imports:return r.languages.FoldingRangeKind.Imports;case n.FoldingRangeKind.Region:return r.languages.FoldingRangeKind.Region}}(e.kind)),t}))}))},e}();t.FoldingRangeAdapter=x;var R=function(){function e(e){this._worker=e}return e.prototype.provideSelectionRanges=function(e,t,n){var r=e.uri;return this._worker(r).then((function(e){return e.getSelectionRanges(r.toString(),t.map(u))})).then((function(e){if(e)return e.map((function(e){for(var t=[];e;)t.push({range:c(e.range)}),e=e.parent;return t}))}))},e}();t.SelectionRangeAdapter=R}));